<script setup>
import { ref } from 'vue'
import axios from 'axios'

// reactive state
const loading = ref(false)
const cve     = ref(null)
const cveData = ref(null)

async function onClick() {
  loading.value = true;
  try {
    const result = await axios.get(`http://127.0.0.1:5000/cve/${cve.value}`)
    cveData.value = result.data;
  } catch (err) {
    console.log(err);
  }
  loading.value = false;
}

function openUrl(url) {
  window.open(url);
}
</script>

<template>
  <v-app>
    <v-main>
      <v-container class="container pa-0 container--fluid">
        <v-layout class="height row justify-center">
          <v-col cols="12">
            <v-row justify="center">
              <v-card
                class="d-flex justify-center"
                color="grey-lighten-3"
                width="50%"
              >
                <v-card-text>
                  <v-text-field
                    v-model="cve"
                    :loading="loading"
                    density="compact"
                    variant="solo"
                    label="Buscar CVE"
                    append-inner-icon="mdi-magnify"
                    single-line
                    hide-details
                    @click:append-inner="onClick"
                  ></v-text-field>
                </v-card-text>
              </v-card>

            </v-row>
            <v-row justify="center">
              <v-card v-if="cveData"
                class="d-flex justify-center ma-4"
                width="50%"
                elevation="4"
              >
                <v-card-text>
                  <p class="text-h4 text--primary">
                    {{ cveData.id }}
                  </p>
                  <v-chip
                    class="mt-2"
                    color="orange"
                    text-color="white"
                    append-icon="mdi-star"
                  >
                    CVSS: {{ cveData.cvss }}
                  </v-chip>
                  <p class="pt-2">

                  </p>
                </v-card-text>
                <v-card-actions>
                  <v-btn
                    variant="text"
                    color="deep-purple-accent-4"
                    @click="openUrl(cveData.references)"
                  >
                    Ler mais
                  </v-btn>
                </v-card-actions>
              </v-card>
            </v-row>
          </v-col>
        </v-layout>
      </v-container>
    </v-main>
  </v-app>
</template>
