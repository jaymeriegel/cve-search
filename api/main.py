from integrations.CirclSearchIntegration import CirclSearchIntegration
from controllers.CveInformationController import CveInformationController
from services.CveInformationService import CveInformationService

from flask import Flask, jsonify, request
from flask_cors import CORS, cross_origin

app = Flask(__name__)
cors = CORS(app)
app.config['CORS_HEADERS'] = 'Content-Type'

@app.route('/cve/<cveId>', methods=['GET'])
@cross_origin()
def api(cveId):
    service = CveInformationService()

    infos = service.get_cve_information(cveId)
    print(infos.id)
    print(infos.cvss)
    print(infos.access.authentication)
    print(infos.references[0])

    return jsonify({
        'id': infos.id,
        'cvss': infos.cvss,
        'authentication': infos.access.authentication,
        'references': infos.references[0]
    })

@app.route('/cve/<cveId>/calculate-cvss', methods=['GET'])
@cross_origin()
def calculateCvss(cveId):
    data = {'message': 'Calculate'}
    return jsonify(data)

if __name__ == '__main__':
    app.run(debug=True)

# def main():
#     inte = CirclSearchIntegration()
#     controller = CveInformationController()
#     service = CveInformationService()

#     print(inte.get_cve_information('CVE-2021-34527'))

#     print('-----------------------------------')
#     infos = service.get_cve_information('CVE-2021-34527')
#     print(infos.id)
#     print(infos.cvss)
#     print(infos.access.authentication)
#     print(infos.references[0])



# if __name__ == "__main__":
#     main()